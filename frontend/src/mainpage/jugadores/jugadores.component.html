<div class="gradient-background">
  <div class="container py-5">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
      <div class="container-fluid">
        <span class="navbar-brand me-auto">
          <i class="bi bi-person-badge"></i> Gestión de Jugadores NFL
        </span>
        <button class="btn btn-outline-light btn-sm" (click)="toggleFormulario()">
          <i class="bi" [ngClass]="mostrarFormulario ? 'bi-eye-slash' : 'bi-eye'"></i>
          {{ mostrarFormulario ? 'Ocultar' : 'Mostrar' }} Formulario
        </button>
      </div>
    </nav>

    <!-- Mensajes de alerta -->
    <div class="alert alert-success alert-dismissible fade show mt-3" role="alert" *ngIf="mensajeExito">
      <i class="bi bi-check-circle"></i> {{ mensajeExito }}
      <button type="button" class="btn-close" (click)="mensajeExito = ''"></button>
    </div>

    <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert" *ngIf="mensajeError">
      <i class="bi bi-exclamation-triangle"></i> {{ mensajeError }}
      <button type="button" class="btn-close" (click)="mensajeError = ''"></button>
    </div>

    <!-- Formulario de creación -->
    <div class="card mt-4 p-4 form-card" *ngIf="mostrarFormulario">
      <h4 class="mb-4">
        <i class="bi bi-plus-circle"></i> Crear Nuevo Jugador
      </h4>
      
      <form (ngSubmit)="crearJugador()">
        <div class="row">
          <!-- Nombre -->
          <div class="col-md-6 mb-3">
            <label for="nombre" class="form-label">
              <i class="bi bi-person"></i> Nombre del Jugador <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              class="form-control"
              id="nombre"
              name="nombre"
              [(ngModel)]="jugador.nombre"
              placeholder="Ej: Patrick Mahomes"
              maxlength="100"
              required
            />
            <small class="text-muted">Máximo 100 caracteres</small>
          </div>

          <!-- Posición -->
          <div class="col-md-6 mb-3">
            <label for="posicion" class="form-label">
              <i class="bi bi-bookmark"></i> Posición <span class="text-danger">*</span>
            </label>
            <select
              class="form-select"
              id="posicion"
              name="posicion"
              [(ngModel)]="jugador.posicion"
              required
            >
              <option value="">Seleccione una posición</option>
              <option *ngFor="let pos of posicionesDisponibles" [value]="pos">
                {{ pos }}
              </option>
            </select>
          </div>

          <!-- Equipo NFL -->
          <div class="col-md-12 mb-3">
            <label for="equipoNFL" class="form-label">
              <i class="bi bi-grid-3x3-gap"></i> Equipo NFL <span class="text-danger">*</span>
            </label>
            <select
              class="form-select"
              id="equipoNFL"
              name="equipoNFL"
              [(ngModel)]="jugador.equipoNFLId"
              required
            >
              <option [value]="0">Seleccione un equipo</option>
              <option *ngFor="let equipo of equiposNFL" [value]="equipo.id">
                {{ equipo.nombre }} - {{ equipo.ciudad }}
              </option>
            </select>
          </div>

          <!-- Imagen Principal -->
          <div class="col-md-6 mb-3">
            <label for="imagen" class="form-label">
              <i class="bi bi-image"></i> Imagen Principal (opcional)
            </label>
            <input
              type="file"
              class="form-control"
              id="imagen"
              accept="image/jpeg,image/png,image/jpg"
              (change)="onImagenSeleccionada($event)"
            />
            <small class="text-muted">Solo JPG/PNG. Máx 5MB. Debe ser cuadrada.</small>
            
            <!-- Preview de imagen -->
            <div class="preview-container mt-2" *ngIf="imagenPreview">
              <img [src]="imagenPreview" alt="Preview" class="img-preview">
              <button type="button" class="btn btn-sm btn-danger mt-2" (click)="limpiarImagen('imagen')">
                <i class="bi bi-x-circle"></i> Quitar imagen
              </button>
            </div>
          </div>

          <!-- Thumbnail -->
          <div class="col-md-6 mb-3">
            <label for="thumbnail" class="form-label">
              <i class="bi bi-card-image"></i> Thumbnail (opcional)
            </label>
            <input
              type="file"
              class="form-control"
              id="thumbnail"
              accept="image/jpeg,image/png,image/jpg"
              (change)="onThumbnailSeleccionado($event)"
            />
            <small class="text-muted">Solo JPG/PNG. Máx 2MB. Debe ser cuadrada.</small>
            
            <!-- Preview de thumbnail -->
            <div class="preview-container mt-2" *ngIf="thumbnailPreview">
              <img [src]="thumbnailPreview" alt="Preview" class="img-preview-small">
              <button type="button" class="btn btn-sm btn-danger mt-2" (click)="limpiarImagen('thumbnail')">
                <i class="bi bi-x-circle"></i> Quitar thumbnail
              </button>
            </div>
          </div>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-custom" [disabled]="cargando || subiendoImagen">
            <i class="bi bi-save"></i>
            <span *ngIf="!cargando && !subiendoImagen">Crear Jugador</span>
            <span *ngIf="cargando && !subiendoImagen">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Creando...
            </span>
            <span *ngIf="subiendoImagen">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Subiendo imágenes...
            </span>
          </button>
          <button type="button" class="btn btn-secondary" (click)="limpiarFormulario()" [disabled]="cargando">
            <i class="bi bi-x-circle"></i> Limpiar
          </button>
        </div>
      </form>
    </div>

    <!-- Filtros -->
    <div class="card mt-4 p-4 form-card">
      <h5 class="mb-3">
        <i class="bi bi-funnel"></i> Filtros
      </h5>
      
      <div class="row">
        <div class="col-md-4 mb-3">
          <label for="filtroEquipo" class="form-label">Filtrar por Equipo</label>
          <select
            class="form-select"
            id="filtroEquipo"
            [(ngModel)]="filtroEquipo"
            (change)="aplicarFiltros()"
          >
            <option [value]="0">Todos los equipos</option>
            <option *ngFor="let equipo of equiposNFL" [value]="equipo.id">
              {{ equipo.nombre }}
            </option>
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label for="filtroPosicion" class="form-label">Filtrar por Posición</label>
          <select
            class="form-select"
            id="filtroPosicion"
            [(ngModel)]="filtroPosicion"
            (change)="aplicarFiltros()"
          >
            <option value="">Todas las posiciones</option>
            <option *ngFor="let pos of posicionesDisponibles" [value]="pos">
              {{ pos }}
            </option>
          </select>
        </div>

        <div class="col-md-4 mb-3">
          <label for="filtroEstado" class="form-label">Filtrar por Estado</label>
          <select
            class="form-select"
            id="filtroEstado"
            [(ngModel)]="filtroEstado"
          >
            <option value="">Todos los estados</option>
            <option value="Activo">Activo</option>
            <option value="Inactivo">Inactivo</option>
          </select>
        </div>
      </div>

      <button class="btn btn-outline-secondary btn-sm" (click)="limpiarFiltros()">
        <i class="bi bi-x-circle"></i> Limpiar Filtros
      </button>
    </div>

    <!-- Lista de jugadores -->
    <div class="mt-4">
      <h4 class="text-white mb-3">
        <i class="bi bi-list-ul"></i> Jugadores Registrados 
        <span class="badge bg-light text-dark">{{ jugadoresFiltrados.length }}</span>
      </h4>

      <!-- Loader -->
      <div class="text-center py-5" *ngIf="cargando && jugadoresCreados.length === 0">
        <div class="spinner-border text-light" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <!-- Sin jugadores -->
      <div class="card p-4 text-center" *ngIf="!cargando && jugadoresFiltrados.length === 0">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <p class="text-muted mt-3">No hay jugadores registrados</p>
      </div>

      <!-- Grid de jugadores -->
      <div class="row g-3" *ngIf="jugadoresFiltrados.length > 0">
        <div class="col-md-6 col-lg-4" *ngFor="let jugador of jugadoresFiltrados">
          <div class="card jugador-card h-100">
            <div class="card-body">
              <!-- Header con imagen o icono -->
              <div class="text-center mb-3">
                <img 
                  *ngIf="jugador.thumbnailUrl" 
                  [src]="jugador.thumbnailUrl" 
                  [alt]="jugador.nombre"
                  class="jugador-thumbnail"
                  (error)="$any($event.target).style.display='none'"
                />
                <i 
                  *ngIf="!jugador.thumbnailUrl" 
                  class="bi bi-person-circle display-1 text-primary"
                ></i>
              </div>

              <!-- Información del jugador -->
              <h5 class="card-title text-center mb-2">{{ jugador.nombre }}</h5>
              
              <div class="jugador-info">
                <p class="mb-2">
                  <i class="bi bi-bookmark text-primary"></i>
                  <strong>Posición:</strong> 
                  <span class="badge bg-primary ms-2">{{ jugador.posicion }}</span>
                </p>
                
                <p class="mb-2">
                  <i class="bi bi-grid-3x3-gap text-success"></i>
                  <strong>Equipo:</strong> {{ jugador.nombreEquipoNFL }}
                </p>
                
                <p class="mb-3">
                  <i class="bi bi-circle-fill" 
                     [class.text-success]="jugador.estado === 'Activo'"
                     [class.text-danger]="jugador.estado === 'Inactivo'"></i>
                  <strong>Estado:</strong> 
                  <span 
                    class="badge ms-2"
                    [class.bg-success]="jugador.estado === 'Activo'"
                    [class.bg-danger]="jugador.estado === 'Inactivo'"
                  >
                    {{ jugador.estado }}
                  </span>
                </p>
              </div>

              <!-- Acciones -->
              <div class="d-flex gap-2 flex-wrap">
                <button 
                  class="btn btn-sm btn-info text-white flex-fill"
                  (click)="verDetalles(jugador.id)"
                >
                  <i class="bi bi-eye"></i> Ver
                </button>
                
                <button 
                  class="btn btn-sm btn-warning text-white flex-fill"
                  (click)="desactivarJugador(jugador.id)"
                  *ngIf="jugador.estado === 'Activo'"
                >
                  <i class="bi bi-pause-circle"></i> Desactivar
                </button>
                
                <button 
                  class="btn btn-sm btn-danger flex-fill"
                  (click)="eliminarJugador(jugador.id)"
                >
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de detalles -->
<div class="modal-backdrop" *ngIf="jugadorSeleccionado" (click)="cerrarDetalles()"></div>
<div class="modal-dialog-custom" *ngIf="jugadorSeleccionado">
  <div class="card form-card">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="bi bi-info-circle"></i> Detalles del Jugador
      </h5>
      <button class="btn btn-sm btn-close btn-close-white" (click)="cerrarDetalles()"></button>
    </div>
    
    <div class="card-body">
      <!-- Imagen -->
      <div class="text-center mb-4" *ngIf="jugadorSeleccionado.imagenUrl">
        <img 
          [src]="jugadorSeleccionado.imagenUrl" 
          [alt]="jugadorSeleccionado.nombre"
          class="img-fluid rounded jugador-image-large"
          (error)="$any($event.target).style.display='none'"
        />
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <strong><i class="bi bi-person"></i> Nombre:</strong>
          <p>{{ jugadorSeleccionado.nombre }}</p>
        </div>

        <div class="col-md-6 mb-3">
          <strong><i class="bi bi-bookmark"></i> Posición:</strong>
          <p><span class="badge bg-primary">{{ jugadorSeleccionado.posicion }}</span></p>
        </div>

        <div class="col-md-6 mb-3">
          <strong><i class="bi bi-grid-3x3-gap"></i> Equipo NFL:</strong>
          <p>{{ jugadorSeleccionado.nombreEquipoNFL }}</p>
        </div>

        <div class="col-md-6 mb-3">
          <strong><i class="bi bi-geo-alt"></i> Ciudad:</strong>
          <p>{{ jugadorSeleccionado.ciudadEquipoNFL }}</p>
        </div>

        <div class="col-md-6 mb-3">
          <strong><i class="bi bi-circle-fill" 
                     [class.text-success]="jugadorSeleccionado.estado === 'Activo'"
                     [class.text-danger]="jugadorSeleccionado.estado === 'Inactivo'"></i> Estado:</strong>
          <p>
            <span 
              class="badge"
              [class.bg-success]="jugadorSeleccionado.estado === 'Activo'"
              [class.bg-danger]="jugadorSeleccionado.estado === 'Inactivo'"
            >
              {{ jugadorSeleccionado.estado }}
            </span>
          </p>
        </div>

        <div class="col-md-6 mb-3">
          <strong><i class="bi bi-calendar-plus"></i> Fecha de Creación:</strong>
          <p>{{ jugadorSeleccionado.fechaCreacion | date:'medium' }}</p>
        </div>

        <div class="col-md-12 mb-3" *ngIf="jugadorSeleccionado.fechaActualizacion">
          <strong><i class="bi bi-calendar-check"></i> Última Actualización:</strong>
          <p>{{ jugadorSeleccionado.fechaActualizacion | date:'medium' }}</p>
        </div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button class="btn btn-secondary flex-fill" (click)="cerrarDetalles()">
          <i class="bi bi-x-circle"></i> Cerrar
        </button>
      </div>
    </div>
  </div>
</div>